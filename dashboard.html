<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
</head>
<body>

<h2>Dashboard</h2>
<button id="logoutBtn">Logout</button>

<hr>

<!-- =============================
     PROFILE PREVIEW
============================== -->
<h3>Your Profile</h3>
<div id="profileBox">Loading profile...</div>

<hr>

<!-- =============================
     ADD PROJECT
============================== -->
<h3>Add Project</h3>
<form id="projectForm">
    <input type="text" id="pTitle" placeholder="Project Title" required><br><br>
    <textarea id="pDesc" placeholder="Description" required></textarea><br><br>

    <select id="pType">
        <option value="Daily">Daily</option>
        <option value="Weekly">Weekly</option>
        <option value="Final Project">Final Project</option>
    </select><br><br>

    <input type="text" id="pDemo" placeholder="Demo Link"><br><br>

    <button type="submit">Add Project</button>
</form>

<h3>Your Projects</h3>
<div id="projectList">Loading...</div>

<hr>

<!-- =============================
     ADD CERTIFICATE
============================== -->
<h3>Add Certificate</h3>

<form id="certForm">
    <input type="text" id="cName" placeholder="Certificate Name" required><br><br>
    <input type="text" id="cIssuer" placeholder="Issuer" required><br><br>
    <input type="date" id="cDate" required><br><br>
    <input type="text" id="cFile" placeholder="Certificate File URL"><br><br>
    <button type="submit">Add Certificate</button>
</form>

<h3>Your Certificates</h3>
<div id="certificateList">Loading...</div>

<hr>

<!-- =============================
     CV GENERATOR
============================== -->
<h3>Generate CV</h3>

<textarea id="cvSummary" placeholder="Ringkasan singkat untuk CV"></textarea><br><br>
<button id="cvBtn">Generate CV</button>

<script type="module">
import { 
    checkLogin,
    logout,
    getProfile,
    addProject,
    getProjects,
    deleteProject,
    addCertificate,
    getCertificates,
    deleteCertificate,
    generateCV
} from "./main.js";


// ===========================
// CHECK LOGIN
// ===========================
await checkLogin();


// ===========================
// LOGOUT BUTTON
// ===========================
document.getElementById("logoutBtn").addEventListener("click", logout);


// ===========================
// LOAD PROFILE
// ===========================
async function loadProfile() {
    const p = await getProfile();
    document.getElementById("profileBox").innerHTML = `
        <strong>${p.full_name}</strong><br>
        ${p.email}
    `;
}
loadProfile();


// ===========================
// PROJECTS CRUD
// ===========================
document.getElementById("projectForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    await addProject(
        pTitle.value,
        pDesc.value,
        pType.value,
        pDemo.value
    );

    loadProjects();
});

async function loadProjects() {
    const list = await getProjects();

    document.getElementById("projectList").innerHTML =
        list.map(p => `
            <div>
                <strong>${p.title}</strong> (${p.project_type})
                <button onclick="deleteProj(${p.id})">Delete</button>
                <br>${p.description}<br>
                <a href="${p.demo_link}" target="_blank">${p.demo_link}</a>
                <hr>
            </div>
        `).join("");
}

window.deleteProj = async (id) => {
    await deleteProject(id);
    loadProjects();
};

loadProjects();


// ===========================
// CERTIFICATES CRUD
// ===========================
document.getElementById("certForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    await addCertificate(
        cName.value,
        cIssuer.value,
        cDate.value,
        cFile.value
    );

    loadCertificates();
});

async function loadCertificates() {
    const certs = await getCertificates();

    document.getElementById("certificateList").innerHTML =
        certs.map(c => `
            <div>
                <strong>${c.name}</strong>
                (${c.issuer} - ${c.issued_date})
                <br>
                <a href="${c.file_url}" target="_blank">${c.file_url}</a>
                <br>
                <button onclick="delCert(${c.id})">Delete</button>
                <hr>
            </div>
        `).join("");
}

window.delCert = async (id) => {
    await deleteCertificate(id);
    loadCertificates();
};

loadCertificates();


// ===========================
// CV GENERATOR
// ===========================
document.getElementById("cvBtn").addEventListener("click", async () => {
    await generateCV(cvSummary.value);
});
</script>

</body>
</html>
